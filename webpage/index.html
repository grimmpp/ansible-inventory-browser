<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html">
  <title>Simple Table Sorting with jQuery - Treehouse Demo</title>
  <meta name="author" content="Jake Rocheleau">
  <link rel="shortcut icon" href="http://d15dxvojnvxp1x.cloudfront.net/assets/favicon.ico">
  <link rel="icon" href="http://d15dxvojnvxp1x.cloudfront.net/assets/favicon.ico">

  <link rel="stylesheet" type="text/css" media="all" href="css/styles.css">
  <link rel="stylesheet" type="text/css" media="all" href="css/scrollableTable.css">
  
  <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
  <!-- https://github.com/Mottie/tablesorter/wiki -->
  <script type="text/javascript" src="js/jquery.tablesorter.min.js"></script>
  <!-- https://mottie.github.io/tablesorter/docs/#Demo -->
  <script type="text/javascript" src="js/scrollableTable.js"></script>

  <script type="text/javascript" src="generated-data/data.js"></script>
</head>

<body>

    <div id="wrapper">
        <div id="buttonBar">
            <button id="btHosts">Hosts</button>
            <button id="btGroups">Groups</button>
            <button id="btAnalyse">Result of Analysis</button>
            <button id="btJSON">Show all Data as JSON</button>
        </div>
        <pre id="detailView" ></pre>
    </div>

    <script type="text/javascript">
        var scrollableTable = new scrollableTable('scrollableTable', 'wrapper')
        scrollableTable.setTableHeight( () => { return $( window ).height() - 118 } )

        function updateTable(tableConfig, data) {
            scrollableTable.setTableHeader(tableConfig['header'])
            if (tableConfig['subtreeProperty'] === undefined) {
                scrollableTable.setTableContent(data, tableConfig['event-type'], tableConfig['columns'])
            } else {
                scrollableTable.setTreeTableContent(data, tableConfig['event-type'], tableConfig['columns'], tableConfig['subtreeProperty'])
                scrollableTable.expandTree()
            }
        }

        // console.log(data); 
        // $('#detailView').html( JSON.stringify( data, null, 4) )

        $('#btJSON').click( function() {
            scrollableTable.clearTable()
            $('#detailView').html( JSON.stringify( data, null, 4) )
        })



        $('#btHosts').click( function() {
            $('#detailView').text("")
            var tableConfig = data['ui-config']['host-view']
            updateTable(tableConfig, data['hosts'])
        })

        $( document ).on("selectedHost", function(event, host) {
            if (host !== "") {
                $('#detailView').html( JSON.stringify( data["hosts"][host], null, 4) )
            } else {
                $('#detailView').html("")
            }
        });


        $('#btGroups').click( function() {
            $('#detailView').text("")
            var tableConfig = data['ui-config']['group-view']
            updateTable(tableConfig, data['trees'])
        })

        // $( document ).on("selectedGroup", function(event, group) {
        //     if (group !== "") {
        //         $('#detailView').html( JSON.stringify( data["groups"][group], null, 4) )
        //     } else {
        //         $('#detailView').html("")
        //     }
        // });

        $( document ).on("selectedGroup", function(event, nestedIndex) {
            // console.log(JSON.stringify(nestedIndex))

            try {
                var object = data["trees"][nestedIndex[0]]
                for(var i=1; i<nestedIndex.length; i++) { object = object.nodes[nestedIndex[i]] }
                var tempObject = JSON.parse(JSON.stringify(object))
                delete tempObject.nodes
                $('#detailView').html( JSON.stringify( tempObject, null, 4) )
            } catch(e) {
                console.error(e)
                $('#detailView').html("")
            }
        });



        $('#btAnalyse').click( function() {
            $('#detailView').text("")
            var tableConfig = data['ui-config']['message-view']
            updateTable(tableConfig, data['messages'])
        })

        $( document ).on("selectedMessage", function(event, message) {
            if (message !== "") {
                $('#detailView').html( JSON.stringify( data["messages"][message]["details"], null, 4) )
            } else {
                $('#detailView').html("")
            }
        });

        // Show host view
        $('#btHosts').trigger( "click" );

    </script>
 
</body>
</html>