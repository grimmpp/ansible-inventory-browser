<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html">
  <title>Ansible Inventory Browser</title>
  <meta name="author" content="Philipp Grimm">
  <link rel="shortcut icon" href="http://d15dxvojnvxp1x.cloudfront.net/assets/favicon.ico">
  <link rel="icon" href="http://d15dxvojnvxp1x.cloudfront.net/assets/favicon.ico">

  <link rel="stylesheet" type="text/css" media="all" href="css/styles.css">
  <link rel="stylesheet" type="text/css" media="all" href="css/scrollableTable.css">
  
  <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
  
  <!-- https://github.com/grimmpp/sortable-and-scrollable-table-with-fixed-header -->
  <script type="text/javascript" src="js/scrollableTable.js"></script>

  <!-- pre-generated data which originally comes from the inventories -->
  <script type="text/javascript" src="generated-data/data.js"></script>
</head>

<body>

    <div id="wrapper">
        <div id="buttonBar">
            <button id="btHosts">Hosts</button>
            <button id="btGroups">Groups</button>
            <button id="btAnalyse">Result of Analysis</button>
            <button id="btJSON">Show all Data as JSON</button>
            <input id="filterTextField" type="text" value="" 
                style="color: grey; padding-left: 8px; height: 26px; "
                onkeydown="onKeyDownFilterTable()" onkeyup="onKeyUpFilterTable()" 
                onfocus="onfocusFilterTable()" onblur="onblurFilterTable()"></span>
        </div>
        <pre id="detailView" ></pre>
    </div>

    <script type="text/javascript">
        var loggingEnabled = false
        var scrollableTable = new scrollableTable('scrollableTable', 'wrapper', loggingEnabled)
        scrollableTable.setTableHeight( () => { return $( window ).height() - 118 } )

        /** Generic function in order to fill table and tree view */
        function updateTable(tableConfig, data) {
            scrollableTable.setTableHeader(tableConfig['header'])
            scrollableTable.setTableContent(data, tableConfig['event-type'], tableConfig['columns'], tableConfig['subtreeProperty'])
            scrollableTable.expandTree()
        }

        /** generic function which shows the json object in #detailedView */
        function showJsonData(event, eventData) {
            if (eventData != null) {
                var tempObject = JSON.parse(JSON.stringify(eventData))
                delete tempObject.nodes
                $('#detailView').html( JSON.stringify( tempObject, null, 4) )
            }
            else {
                $('#detailView').html("")
            }
        }

        /* button hosts onClick() => fill table with hosts */
        $('#btHosts').click( function() {
            resetFilterTextField()
            $('#detailView').text("")
            var tableConfig = data['ui-config']['host-view']
            updateTable(tableConfig, data['hosts'])
        })

        /* event listener for 'selectedHost' => show JSON in host detailView */
        $( document ).on("selectedHost", showJsonData );

        /* button group onClick() => fill tree table with nested groups and hosts */
        $('#btGroups').click( function() {
            resetFilterTextField()
            $('#detailView').text("")
            var tableConfig = data['ui-config']['group-view']
            updateTable(tableConfig, data['trees'])
        })

        /* event listener for 'selectedGroup' => show JSON of group in detailView */
        $( document ).on("selectedGroup", showJsonData );

        /* button analyse onClick() => fill table with messages which were generated during parsing of the inventories. */
        $('#btAnalyse').click( function() {
            resetFilterTextField()
            $('#detailView').text("")
            var tableConfig = data['ui-config']['message-view']
            updateTable(tableConfig, data['messages'])
        })

        /* event listener for 'selectedMessage' => show JSON of message in detailView */
        $( document ).on("selectedMessage", showJsonData );

        /* button JSON onClick() => show whole JSON data about everything which was parsed through all inventories */
        $('#btJSON').click( function() {
            resetFilterTextField()
            scrollableTable.clearTableContent()
            $('#detailView').html( JSON.stringify( data, null, 4) )
        })


        /**
         * filter functions 
         */

        var filterInfoText = "type to filter table"
        resetFilterTextField()
        function resetFilterTextField() {
            $('#filterTextField').val('')
            onblurFilterTable()
        }
        function onKeyDownFilterTable() { 
            var value = $('#filterTextField').val()

            if (value == filterInfoText) onfocusFilterTable()
            else scrollableTable.filter($('#filterTextField').val()) 
        }
        function onKeyUpFilterTable() { 
            var value = $('#filterTextField').val()

            if (value == '') onblurFilterTable()
            else if (value == filterInfoText) {
                setCaretToPos( document.getElementById('filterTextField'), 0);
                scrollableTable.filter('')
            }
            else {
                scrollableTable.filter($('#filterTextField').val()) 
            }
        }
        function onfocusFilterTable() {
            if ($('#filterTextField').val() == filterInfoText) {
                $('#filterTextField').val('')
                $('#filterTextField').css('color', 'black') 
            }
        }
        function onblurFilterTable() { 
            if ($('#filterTextField').val() == '') { 
                $('#filterTextField').css('color', 'grey') 
                $('#filterTextField').val(filterInfoText)
            }
            if ($('#filterTextField').val() == filterInfoText) {
                scrollableTable.filter('')
            }
        }

        function setSelectionRange(input, selectionStart, selectionEnd) {
            if (input.setSelectionRange) {
                input.focus();
                input.setSelectionRange(selectionStart, selectionEnd);
            }
            else if (input.createTextRange) {
                var range = input.createTextRange();
                range.collapse(true);
                range.moveEnd('character', selectionEnd);
                range.moveStart('character', selectionStart);
                range.select();
            }
        }
        function setCaretToPos(input, pos) {
            setSelectionRange(input, pos, pos);
        }

        /**
         * end filter functions 
         */

        // Initially load host view
        $('#btHosts').trigger( "click" );

    </script>
 
</body>
</html>